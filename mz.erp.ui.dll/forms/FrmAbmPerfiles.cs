using System;
using System.Drawing;
using System.Collections;
using System.ComponentModel;
using System.Windows.Forms;
using mz.erp.ui.controllers;
using mz.erp.ui.forms.classes;

namespace mz.erp.ui.forms
{
	/// <summary>
	/// Descripción breve de FrmAbmPerfiles.
	/// </summary>
	public class FrmAbmPerfiles : System.Windows.Forms.Form, ITaskForm
	{
		private System.Windows.Forms.ToolBar toolBarStandar;
		private System.Windows.Forms.ToolBarButton toolBarButton1;
		private System.Windows.Forms.ToolBarButton toolBarButton2;
		private System.Windows.Forms.ToolBarButton toolBarButton3;
		protected Infragistics.Win.UltraWinExplorerBar.UltraExplorerBar ultraExplorerBar1;
		private Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarContainerControl ultraExplorerBarContainerControl2;
		private Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarContainerControl ultraExplorerBarContainerControl1;
		private System.Windows.Forms.Label labelTarea;
		private System.Windows.Forms.ImageList imageList2;
		private System.Windows.Forms.GroupBox groupBox1;
		private System.Windows.Forms.GroupBox groupBox2;
		private System.Windows.Forms.TextBox txtDescripcion;
		private System.Windows.Forms.Label label1;
		private System.Windows.Forms.CheckedListBox listPerfiles;
		private System.Windows.Forms.Button btnSubir;
		private System.Windows.Forms.Button btnBajar;
		private System.Windows.Forms.ImageList imglStandar;
		private System.Windows.Forms.ListBox listPerfilesOrdenados;
		private System.Windows.Forms.CheckBox chkActivo;
		private System.Windows.Forms.Label label2;
		private Infragistics.Win.UltraWinMaskedEdit.UltraMaskedEdit txtIdPerfil;
		private Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarContainerControl ultraExplorerBarContainerControl3;
		private System.Windows.Forms.GroupBox groupBox3;
		private System.Windows.Forms.Label label3;
		private mz.erp.ui.controls.mzComboEditor mzCEBusquedaPerfiles;
		private System.Windows.Forms.Label label4;
		private System.Windows.Forms.Label label5;
		private System.ComponentModel.IContainer components;

		public FrmAbmPerfiles()
		{
			//
			// Necesario para admitir el Diseñador de Windows Forms
			//
			InitializeComponent();

			//
			// TODO: agregar código de constructor después de llamar a InitializeComponent
			//
		}

		public FrmAbmPerfiles(AbmPerfilController controller)
		{
			InitializeComponent();
			_uiController = controller;
		}

		#region Variables Privadas
		private mz.erp.ui.controllers.AbmPerfilController _uiController;
		#endregion

		/// <summary>
		/// Limpiar los recursos que se estén utilizando.
		/// </summary>
		protected override void Dispose( bool disposing )
		{
			if( disposing )
			{
				if(components != null)
				{
					components.Dispose();
				}
			}
			base.Dispose( disposing );
		}

		#region Código generado por el Diseñador de Windows Forms
		/// <summary>
		/// Método necesario para admitir el Diseñador. No se puede modificar
		/// el contenido del método con el editor de código.
		/// </summary>
		private void InitializeComponent()
		{
			this.components = new System.ComponentModel.Container();
			System.Resources.ResourceManager resources = new System.Resources.ResourceManager(typeof(FrmAbmPerfiles));
			Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup ultraExplorerBarGroup1 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup();
			Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup ultraExplorerBarGroup2 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup();
			Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup ultraExplorerBarGroup3 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup();
			this.ultraExplorerBarContainerControl1 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarContainerControl();
			this.labelTarea = new System.Windows.Forms.Label();
			this.ultraExplorerBarContainerControl3 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarContainerControl();
			this.groupBox3 = new System.Windows.Forms.GroupBox();
			this.mzCEBusquedaPerfiles = new mz.erp.ui.controls.mzComboEditor();
			this.label3 = new System.Windows.Forms.Label();
			this.ultraExplorerBarContainerControl2 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarContainerControl();
			this.groupBox2 = new System.Windows.Forms.GroupBox();
			this.txtDescripcion = new System.Windows.Forms.TextBox();
			this.txtIdPerfil = new Infragistics.Win.UltraWinMaskedEdit.UltraMaskedEdit();
			this.label2 = new System.Windows.Forms.Label();
			this.chkActivo = new System.Windows.Forms.CheckBox();
			this.label1 = new System.Windows.Forms.Label();
			this.groupBox1 = new System.Windows.Forms.GroupBox();
			this.listPerfilesOrdenados = new System.Windows.Forms.ListBox();
			this.listPerfiles = new System.Windows.Forms.CheckedListBox();
			this.label5 = new System.Windows.Forms.Label();
			this.label4 = new System.Windows.Forms.Label();
			this.btnSubir = new System.Windows.Forms.Button();
			this.imglStandar = new System.Windows.Forms.ImageList(this.components);
			this.btnBajar = new System.Windows.Forms.Button();
			this.toolBarStandar = new System.Windows.Forms.ToolBar();
			this.toolBarButton1 = new System.Windows.Forms.ToolBarButton();
			this.toolBarButton2 = new System.Windows.Forms.ToolBarButton();
			this.toolBarButton3 = new System.Windows.Forms.ToolBarButton();
			this.imageList2 = new System.Windows.Forms.ImageList(this.components);
			this.ultraExplorerBar1 = new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBar();
			this.ultraExplorerBarContainerControl1.SuspendLayout();
			this.ultraExplorerBarContainerControl3.SuspendLayout();
			this.groupBox3.SuspendLayout();
			((System.ComponentModel.ISupportInitialize)(this.mzCEBusquedaPerfiles)).BeginInit();
			this.ultraExplorerBarContainerControl2.SuspendLayout();
			this.groupBox2.SuspendLayout();
			this.groupBox1.SuspendLayout();
			((System.ComponentModel.ISupportInitialize)(this.ultraExplorerBar1)).BeginInit();
			this.ultraExplorerBar1.SuspendLayout();
			this.SuspendLayout();
			// 
			// ultraExplorerBarContainerControl1
			// 
			this.ultraExplorerBarContainerControl1.Controls.Add(this.labelTarea);
			this.ultraExplorerBarContainerControl1.Location = new System.Drawing.Point(28, 24);
			this.ultraExplorerBarContainerControl1.Name = "ultraExplorerBarContainerControl1";
			this.ultraExplorerBarContainerControl1.Size = new System.Drawing.Size(551, 26);
			this.ultraExplorerBarContainerControl1.TabIndex = 2;
			// 
			// labelTarea
			// 
			this.labelTarea.BackColor = System.Drawing.Color.Transparent;
			this.labelTarea.Dock = System.Windows.Forms.DockStyle.Top;
			this.labelTarea.Font = new System.Drawing.Font("Microsoft Sans Serif", 12F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, ((System.Byte)(0)));
			this.labelTarea.Location = new System.Drawing.Point(0, 0);
			this.labelTarea.Name = "labelTarea";
			this.labelTarea.Size = new System.Drawing.Size(551, 24);
			this.labelTarea.TabIndex = 2;
			this.labelTarea.Text = "Label Tarea";
			this.labelTarea.TextAlign = System.Drawing.ContentAlignment.MiddleCenter;
			// 
			// ultraExplorerBarContainerControl3
			// 
			this.ultraExplorerBarContainerControl3.Controls.Add(this.groupBox3);
			this.ultraExplorerBarContainerControl3.Location = new System.Drawing.Point(28, 109);
			this.ultraExplorerBarContainerControl3.Name = "ultraExplorerBarContainerControl3";
			this.ultraExplorerBarContainerControl3.Size = new System.Drawing.Size(551, 43);
			this.ultraExplorerBarContainerControl3.TabIndex = 3;
			// 
			// groupBox3
			// 
			this.groupBox3.Controls.Add(this.mzCEBusquedaPerfiles);
			this.groupBox3.Controls.Add(this.label3);
			this.groupBox3.Location = new System.Drawing.Point(0, 0);
			this.groupBox3.Name = "groupBox3";
			this.groupBox3.Size = new System.Drawing.Size(546, 42);
			this.groupBox3.TabIndex = 37;
			this.groupBox3.TabStop = false;
			// 
			// mzCEBusquedaPerfiles
			// 
			this.mzCEBusquedaPerfiles.AutoComplete = true;
			this.mzCEBusquedaPerfiles.DataSource = null;
			this.mzCEBusquedaPerfiles.DisplayMember = "";
			this.mzCEBusquedaPerfiles.DisplayMemberCaption = "";
			this.mzCEBusquedaPerfiles.DropDownStyle = Infragistics.Win.DropDownStyle.DropDownList;
			this.mzCEBusquedaPerfiles.Location = new System.Drawing.Point(88, 13);
			this.mzCEBusquedaPerfiles.MaxItemsDisplay = 50;
			this.mzCEBusquedaPerfiles.MoreItemsDisplayText = "(Ver mas elementos...)";
			this.mzCEBusquedaPerfiles.Name = "mzCEBusquedaPerfiles";
			this.mzCEBusquedaPerfiles.Size = new System.Drawing.Size(199, 21);
			this.mzCEBusquedaPerfiles.SorterMember = "";
			this.mzCEBusquedaPerfiles.TabIndex = 0;
			this.mzCEBusquedaPerfiles.ValueMember = "";
			this.mzCEBusquedaPerfiles.ValueMemberCaption = "";
			// 
			// label3
			// 
			this.label3.BackColor = System.Drawing.Color.Transparent;
			this.label3.Location = new System.Drawing.Point(13, 17);
			this.label3.Name = "label3";
			this.label3.Size = new System.Drawing.Size(67, 16);
			this.label3.TabIndex = 37;
			this.label3.Text = "Perfiles";
			// 
			// ultraExplorerBarContainerControl2
			// 
			this.ultraExplorerBarContainerControl2.Controls.Add(this.groupBox2);
			this.ultraExplorerBarContainerControl2.Controls.Add(this.groupBox1);
			this.ultraExplorerBarContainerControl2.Location = new System.Drawing.Point(28, 211);
			this.ultraExplorerBarContainerControl2.Name = "ultraExplorerBarContainerControl2";
			this.ultraExplorerBarContainerControl2.Size = new System.Drawing.Size(551, 335);
			this.ultraExplorerBarContainerControl2.TabIndex = 0;
			// 
			// groupBox2
			// 
			this.groupBox2.Controls.Add(this.txtDescripcion);
			this.groupBox2.Controls.Add(this.txtIdPerfil);
			this.groupBox2.Controls.Add(this.label2);
			this.groupBox2.Controls.Add(this.chkActivo);
			this.groupBox2.Controls.Add(this.label1);
			this.groupBox2.Location = new System.Drawing.Point(0, 0);
			this.groupBox2.Name = "groupBox2";
			this.groupBox2.Size = new System.Drawing.Size(546, 60);
			this.groupBox2.TabIndex = 36;
			this.groupBox2.TabStop = false;
			// 
			// txtDescripcion
			// 
			this.txtDescripcion.AllowDrop = true;
			this.txtDescripcion.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
			this.txtDescripcion.Location = new System.Drawing.Point(88, 33);
			this.txtDescripcion.MaxLength = 100;
			this.txtDescripcion.Name = "txtDescripcion";
			this.txtDescripcion.Size = new System.Drawing.Size(199, 20);
			this.txtDescripcion.TabIndex = 3;
			this.txtDescripcion.Text = "";
			// 
			// txtIdPerfil
			// 
			this.txtIdPerfil.EditAs = Infragistics.Win.UltraWinMaskedEdit.EditAsType.Long;
			this.txtIdPerfil.InputMask = "nnnnn";
			this.txtIdPerfil.Location = new System.Drawing.Point(88, 11);
			this.txtIdPerfil.Name = "txtIdPerfil";
			this.txtIdPerfil.Size = new System.Drawing.Size(80, 20);
			this.txtIdPerfil.TabIndex = 1;
			// 
			// label2
			// 
			this.label2.BackColor = System.Drawing.Color.Transparent;
			this.label2.Location = new System.Drawing.Point(13, 15);
			this.label2.Name = "label2";
			this.label2.Size = new System.Drawing.Size(100, 16);
			this.label2.TabIndex = 37;
			this.label2.Text = "Nro Perfil";
			// 
			// chkActivo
			// 
			this.chkActivo.CheckAlign = System.Drawing.ContentAlignment.MiddleRight;
			this.chkActivo.Location = new System.Drawing.Point(214, 12);
			this.chkActivo.Name = "chkActivo";
			this.chkActivo.Size = new System.Drawing.Size(72, 19);
			this.chkActivo.TabIndex = 2;
			this.chkActivo.Text = "Activo";
			// 
			// label1
			// 
			this.label1.BackColor = System.Drawing.Color.Transparent;
			this.label1.Location = new System.Drawing.Point(13, 35);
			this.label1.Name = "label1";
			this.label1.Size = new System.Drawing.Size(100, 16);
			this.label1.TabIndex = 34;
			this.label1.Text = "Descripcion";
			// 
			// groupBox1
			// 
			this.groupBox1.Controls.Add(this.listPerfilesOrdenados);
			this.groupBox1.Controls.Add(this.listPerfiles);
			this.groupBox1.Controls.Add(this.label5);
			this.groupBox1.Controls.Add(this.label4);
			this.groupBox1.Controls.Add(this.btnSubir);
			this.groupBox1.Controls.Add(this.btnBajar);
			this.groupBox1.Location = new System.Drawing.Point(0, 63);
			this.groupBox1.Name = "groupBox1";
			this.groupBox1.Size = new System.Drawing.Size(546, 273);
			this.groupBox1.TabIndex = 27;
			this.groupBox1.TabStop = false;
			this.groupBox1.Text = " Seleccionar Perfiles";
			// 
			// listPerfilesOrdenados
			// 
			this.listPerfilesOrdenados.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
			this.listPerfilesOrdenados.Location = new System.Drawing.Point(294, 33);
			this.listPerfilesOrdenados.Name = "listPerfilesOrdenados";
			this.listPerfilesOrdenados.Size = new System.Drawing.Size(208, 158);
			this.listPerfilesOrdenados.TabIndex = 5;
			// 
			// listPerfiles
			// 
			this.listPerfiles.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
			this.listPerfiles.Location = new System.Drawing.Point(11, 33);
			this.listPerfiles.Name = "listPerfiles";
			this.listPerfiles.Size = new System.Drawing.Size(276, 227);
			this.listPerfiles.TabIndex = 4;
			// 
			// label5
			// 
			this.label5.BackColor = System.Drawing.Color.Transparent;
			this.label5.Location = new System.Drawing.Point(295, 17);
			this.label5.Name = "label5";
			this.label5.Size = new System.Drawing.Size(136, 16);
			this.label5.TabIndex = 40;
			this.label5.Text = "Orden por prioridad";
			// 
			// label4
			// 
			this.label4.BackColor = System.Drawing.Color.Transparent;
			this.label4.Location = new System.Drawing.Point(12, 17);
			this.label4.Name = "label4";
			this.label4.Size = new System.Drawing.Size(100, 16);
			this.label4.TabIndex = 39;
			this.label4.Text = "Perfiles existentes";
			// 
			// btnSubir
			// 
			this.btnSubir.ImageIndex = 11;
			this.btnSubir.ImageList = this.imglStandar;
			this.btnSubir.Location = new System.Drawing.Point(510, 76);
			this.btnSubir.Name = "btnSubir";
			this.btnSubir.Size = new System.Drawing.Size(25, 32);
			this.btnSubir.TabIndex = 6;
			// 
			// imglStandar
			// 
			this.imglStandar.ImageSize = new System.Drawing.Size(16, 16);
			this.imglStandar.ImageStream = ((System.Windows.Forms.ImageListStreamer)(resources.GetObject("imglStandar.ImageStream")));
			this.imglStandar.TransparentColor = System.Drawing.Color.Transparent;
			// 
			// btnBajar
			// 
			this.btnBajar.ImageIndex = 12;
			this.btnBajar.ImageList = this.imglStandar;
			this.btnBajar.Location = new System.Drawing.Point(510, 108);
			this.btnBajar.Name = "btnBajar";
			this.btnBajar.Size = new System.Drawing.Size(25, 32);
			this.btnBajar.TabIndex = 7;
			// 
			// toolBarStandar
			// 
			this.toolBarStandar.Appearance = System.Windows.Forms.ToolBarAppearance.Flat;
			this.toolBarStandar.Buttons.AddRange(new System.Windows.Forms.ToolBarButton[] {
																							  this.toolBarButton1,
																							  this.toolBarButton2,
																							  this.toolBarButton3});
			this.toolBarStandar.DropDownArrows = true;
			this.toolBarStandar.ImageList = this.imageList2;
			this.toolBarStandar.Location = new System.Drawing.Point(0, 0);
			this.toolBarStandar.Name = "toolBarStandar";
			this.toolBarStandar.ShowToolTips = true;
			this.toolBarStandar.Size = new System.Drawing.Size(600, 28);
			this.toolBarStandar.TabIndex = 22;
			this.toolBarStandar.TextAlign = System.Windows.Forms.ToolBarTextAlign.Right;
			// 
			// toolBarButton1
			// 
			this.toolBarButton1.ImageIndex = 4;
			this.toolBarButton1.Text = "&Aceptar";
			// 
			// toolBarButton2
			// 
			this.toolBarButton2.Style = System.Windows.Forms.ToolBarButtonStyle.Separator;
			// 
			// toolBarButton3
			// 
			this.toolBarButton3.ImageIndex = 7;
			this.toolBarButton3.Text = "&Cancelar";
			// 
			// imageList2
			// 
			this.imageList2.ImageSize = new System.Drawing.Size(16, 16);
			this.imageList2.ImageStream = ((System.Windows.Forms.ImageListStreamer)(resources.GetObject("imageList2.ImageStream")));
			this.imageList2.TransparentColor = System.Drawing.Color.Magenta;
			// 
			// ultraExplorerBar1
			// 
			this.ultraExplorerBar1.Controls.Add(this.ultraExplorerBarContainerControl2);
			this.ultraExplorerBar1.Controls.Add(this.ultraExplorerBarContainerControl1);
			this.ultraExplorerBar1.Controls.Add(this.ultraExplorerBarContainerControl3);
			this.ultraExplorerBar1.Cursor = System.Windows.Forms.Cursors.Hand;
			this.ultraExplorerBar1.Dock = System.Windows.Forms.DockStyle.Fill;
			ultraExplorerBarGroup1.Container = this.ultraExplorerBarContainerControl1;
			ultraExplorerBarGroup1.Key = "Tarea";
			ultraExplorerBarGroup1.Settings.ContainerHeight = 26;
			ultraExplorerBarGroup1.Settings.HeaderVisible = Infragistics.Win.DefaultableBoolean.False;
			ultraExplorerBarGroup1.Settings.Style = Infragistics.Win.UltraWinExplorerBar.GroupStyle.ControlContainer;
			ultraExplorerBarGroup1.Text = "Leyenda";
			ultraExplorerBarGroup2.Container = this.ultraExplorerBarContainerControl3;
			ultraExplorerBarGroup2.Key = "Busqueda";
			ultraExplorerBarGroup2.Settings.ContainerHeight = 43;
			ultraExplorerBarGroup2.Settings.Style = Infragistics.Win.UltraWinExplorerBar.GroupStyle.ControlContainer;
			ultraExplorerBarGroup2.Text = "Seleccionar Perfil";
			ultraExplorerBarGroup3.Container = this.ultraExplorerBarContainerControl2;
			ultraExplorerBarGroup3.Key = "Datos";
			ultraExplorerBarGroup3.Settings.ContainerHeight = 335;
			ultraExplorerBarGroup3.Settings.HeaderVisible = Infragistics.Win.DefaultableBoolean.True;
			ultraExplorerBarGroup3.Settings.Style = Infragistics.Win.UltraWinExplorerBar.GroupStyle.ControlContainer;
			ultraExplorerBarGroup3.Text = "Datos Perfil";
			this.ultraExplorerBar1.Groups.AddRange(new Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup[] {
																														ultraExplorerBarGroup1,
																														ultraExplorerBarGroup2,
																														ultraExplorerBarGroup3});
			this.ultraExplorerBar1.Location = new System.Drawing.Point(0, 28);
			this.ultraExplorerBar1.Name = "ultraExplorerBar1"; this.ultraExplorerBar1.AnimationEnabled = false; //German 20101207 - Tarea Infragistics 2008  Tarea 983
			this.ultraExplorerBar1.Size = new System.Drawing.Size(600, 574);
			this.ultraExplorerBar1.TabIndex = 0;
			this.ultraExplorerBar1.TabStop = false;
			// 
			// FrmAbmPerfiles
			// 
			this.AutoScaleBaseSize = new System.Drawing.Size(5, 13);
			this.ClientSize = new System.Drawing.Size(600, 602);
			this.Controls.Add(this.ultraExplorerBar1);
			this.Controls.Add(this.toolBarStandar);
			this.Name = "FrmAbmPerfiles";
			this.Text = "FrmAbmPerfiles";
			this.ultraExplorerBarContainerControl1.ResumeLayout(false);
			this.ultraExplorerBarContainerControl3.ResumeLayout(false);
			this.groupBox3.ResumeLayout(false);
			((System.ComponentModel.ISupportInitialize)(this.mzCEBusquedaPerfiles)).EndInit();
			this.ultraExplorerBarContainerControl2.ResumeLayout(false);
			this.groupBox2.ResumeLayout(false);
			this.groupBox1.ResumeLayout(false);
			((System.ComponentModel.ISupportInitialize)(this.ultraExplorerBar1)).EndInit();
			this.ultraExplorerBar1.ResumeLayout(false);
			this.ResumeLayout(false);

		}
		#endregion

		#region Miembros de ITaskForm

		public void ShowForm()
		{
			if(this._uiController.AllowShow())
			{
				this.Build_UI();
				base.Show();
			}
			else
			{
				if(_uiController.IsNextState())
					this._uiController.Execute();
				else
					if(_uiController.IsBackState())
					this._uiController.Previous();
			}
		}

		public void CloseForm()
		{			
			if (_uiController.PreguntarAlCancelar)
			{
				if ((MessageBox.Show(this,"Está a punto de cerrar el fomulario. Realmente desea realizar esta operación?","Atención!",System.Windows.Forms.MessageBoxButtons.OKCancel, System.Windows.Forms.MessageBoxIcon.Stop )== System.Windows.Forms.DialogResult.OK))
					Close();
			}
			else
			{
				Close();
			}
		}

		public void KeyDownPrevious()
		{
		}

		public void KeyDownNext()
		{
		}

		public void Execute()
		{
			this._uiController.Execute();
		}

		public void Previous()
		{
			this._uiController.Previous();
		}

		#endregion

		#region Inicializadores

		private void Build_UI()
		{
			ConfigureInterface();
			InitializeData();
			InitEventHandlers();
			InitDataBindings();
		}
	
		private void ConfigureInterface()
		{
			this.Text=_uiController.LeyendaFormulario();
			this.labelTarea.Text=_uiController.LeyendaFormulario();

			foreach( Infragistics.Win.UltraWinExplorerBar.UltraExplorerBarGroup group in this.ultraExplorerBar1.Groups)
				group.Visible = false;
			if(!_uiController.ContenedoresVisibles.Equals(string.Empty))
			{
				ArrayList cont = mz.erp.systemframework.Util.Parse(_uiController.ContenedoresVisibles, ",");
				foreach(string grupo in cont)
				{
					this.ultraExplorerBar1.Groups[grupo].Visible = true;
				}
			}

			if (_uiController.EditMode)
			{
				listPerfilesOrdenados.Enabled=false;
				listPerfiles.Enabled=false;
				txtIdPerfil.Enabled=false;
				btnBajar.Enabled=false;
				btnSubir.Enabled=false;
			}
			KeyPreview = true;
			mz.erp.ui.forms.classes.ContainerManager.CollapseContainers(ultraExplorerBar1, _uiController.GetProcessName(), _uiController.GetTaskName());
			
		}
		
		private void InitEventHandlers()
		{
			this.toolBarStandar.ButtonClick += new System.Windows.Forms.ToolBarButtonClickEventHandler(this.toolBarStandar_ButtonClick);
			this.listPerfiles.ItemCheck += new System.Windows.Forms.ItemCheckEventHandler(this.listPerfiles_ItemCheck);
			this.btnSubir.Click += new System.EventHandler(this.btnSubir_Click);
			this.btnBajar.Click += new System.EventHandler(this.btnBajar_Click);
			this.mzCEBusquedaPerfiles.ValueChanged += new System.EventHandler(this.mzCEBusquedaPerfiles_ValueChanged);
			this.chkActivo.CheckedChanged += new System.EventHandler(this.chkActivo_CheckedChanged);
		}

		private void InitializeData()
		{
			foreach(mz.erp.businessrules.Perfil p in _uiController.PerfilesVisibles)
			{
				string descripcion = p.Descripcion + ", NroPerfil:" + p.IdPerfil;
				listPerfiles.Items.Add(descripcion, false);
			}

			mzCEBusquedaPerfiles.FillFromDataSource(_uiController.DataTablePerfilesVisibles, _uiController.KeyValuePerfil, _uiController.KeyListPerfil, 100, _uiController.KeyListPerfil);
	
		}

		private void InitDataBindings()
		{
			//this.mzCEBusquedaPerfiles.DataBindings.Add("Value", _uiController, "IdPerfil");
		}

		#endregion

		private void toolBarStandar_ButtonClick(object sender, System.Windows.Forms.ToolBarButtonClickEventArgs e)
		{
			switch ( toolBarStandar.Buttons.IndexOf( e.Button ) )
			{
				case 0:
					this.DumpControls();
					_uiController.Execute();
					break;
				case 2:
					CloseForm();
					break;
			}
		}

		private void listPerfiles_ItemCheck(object sender, System.Windows.Forms.ItemCheckEventArgs e)
		{
			int x = listPerfiles.SelectedIndex;
			if (listPerfiles.CheckedIndices.Contains(x))
				listPerfilesOrdenados.Items.Remove(listPerfiles.Items[x]);
			else
				listPerfilesOrdenados.Items.Add(listPerfiles.Items[x]);//p.Descripcion
		}

		private void DumpControls()
		{
			_uiController.IdPerfil = txtIdPerfil.Text;
			_uiController.Descripcion = txtDescripcion.Text;
			_uiController.Activo = chkActivo.Checked;
			foreach(string perfilDescripcion in listPerfilesOrdenados.Items)
			{
				ArrayList listPerfiles = mz.erp.systemframework.Util.Parse(perfilDescripcion, ":");
				string idPerfil = Convert.ToString(listPerfiles[(listPerfiles.Count-1)]);
				_uiController.AddIdPerfilesACopiar(idPerfil);
			}
			
		}

		private void btnSubir_Click(object sender, System.EventArgs e)
		{
			int index = listPerfilesOrdenados.SelectedIndex;
			if(index != -1)
			{
				if(index > 0)
				{
					
					object aux = listPerfilesOrdenados.Items[index];
					listPerfilesOrdenados.Items[index] = listPerfilesOrdenados.Items[index - 1];
					listPerfilesOrdenados.Items[index - 1] = aux;
					listPerfilesOrdenados.SelectedIndex = index -1;
				}
			}
		}

		private void btnBajar_Click(object sender, System.EventArgs e)
		{
			int index = listPerfilesOrdenados.SelectedIndex;
			if(index != -1)
			{
				if(index < listPerfilesOrdenados.Items.Count - 1)
				{
					object aux = listPerfilesOrdenados.Items[index];
					listPerfilesOrdenados.Items[index] = listPerfilesOrdenados.Items[index + 1];
					listPerfilesOrdenados.Items[index + 1] = aux;
					listPerfilesOrdenados.SelectedIndex = index + 1;
				}
			}
		}

		private void chkActivo_CheckedChanged(object sender, System.EventArgs e)
		{
			//_uiController.NuevoPerfilActivo = this.chkActivo.Checked;
			_uiController.Activo = this.chkActivo.Checked;
		}

		private void mzCEBusquedaPerfiles_ValueChanged(object sender, System.EventArgs e)
		{
			if (!mzCEBusquedaPerfiles.Value.Equals(string.Empty))
			{
				_uiController.IdPerfil=Convert.ToString(mzCEBusquedaPerfiles.Value);
				txtDescripcion.Text=_uiController.Descripcion;
				txtIdPerfil.Text=_uiController.IdPerfil;
				chkActivo.Checked=_uiController.Activo;
			}
		}
		
		
	}
}
